!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("@angular/core"),require("d3")):"function"==typeof define&&define.amd?define(["exports","@angular/core","d3"],i):i(t.KnobModule={},t.ng.core,t.d3)}(this,function(t,i,s){"use strict";var o=function(){function t(t){this.el=t,this.valueChange=new i.EventEmitter,this.element=this.el.nativeElement,this.value=0,this.defaultOptions={skin:{type:"simple",width:10,color:"rgba(255,0,0,.5)",spaceWidth:5},animate:{enabled:!0,duration:1e3,ease:"bounce"},size:200,startAngle:0,endAngle:360,unit:"",displayInput:!0,inputFormatter:function(t){return t},readOnly:!1,trackWidth:50,barWidth:50,trackColor:"rgba(0,0,0,0)",barColor:"rgba(255,0,0,.5)",prevBarColor:"rgba(0,0,0,0)",textColor:"#222",barCap:0,trackCap:0,fontSize:"auto",fontWeigth:"400",fontFamily:"Arial",subText:{enabled:!1,text:"",fontFamily:"Arial",fontWeight:"normal",color:"gray",font:"auto",offset:0},bgColor:"",bgFull:!1,scale:{enabled:!1,type:"lines",color:"gray",width:4,quantity:20,height:10,spaceWidth:15},step:1,displayPrevious:!1,min:0,max:100,dynamicOptions:!1},this.animations={linear:s.easeLinear,bounce:s.easeBounce}}return t.prototype.ngOnInit=function(){this.inDrag=!1,this.options=Object.assign(this.defaultOptions,this.options),this.draw()},t.prototype.ngOnChanges=function(t){null!=this.defaultOptions&&null!=t.options&&null!=t.options.currentValue&&null!=this.value&&(this.options=Object.assign(this.defaultOptions,t.options.currentValue),this.draw()),null!=this.defaultOptions&&null!=this.options&&null!=t.value.currentValue&&null!=t.value.previousValue&&t.value.currentValue!==t.value.previousValue&&this.setValue(t.value.currentValue)},t.prototype.valueToRadians=function(t,i,s,o,e){return void 0===s&&(s=0),void 0===o&&(o=0),void 0===e&&(e=0),i=i||100,e=e||0,s=s||360,o=o||0,Math.PI/180*((t-e)*(s-o)/(i-e)+o)},t.prototype.radiansToValue=function(t,i,s,o,e){return i=i||100,s=s||0,o=o||360,e=e||0,(180/Math.PI*t-e)*(i-s)/(o-e)+s},t.prototype.createArc=function(t,i,o,e,n){return s.arc().innerRadius(t).outerRadius(i).startAngle(o).endAngle(e).cornerRadius(n)},t.prototype.drawArc=function(t,i,s,o,e,n){var a=t.append("path").attr("id",s).attr("d",i);for(var r in o)a.style(r,o[r]);return a.attr("transform","translate("+this.options.size/2+", "+this.options.size/2+")"),!1===this.options.readOnly&&(e&&a.on("click",e),n&&a.call(n)),a},t.prototype.createArcs=function(){var t=parseInt((this.options.size/2).toString(),10),i=this.valueToRadians(this.options.startAngle,360),s=this.valueToRadians(this.options.endAngle,360);this.options.scale.enabled&&(t-=this.options.scale.width+this.options.scale.spaceWidth);var o,e=t-this.options.trackWidth,n=t-this.options.barWidth,a=t-this.options.barWidth,r=t,l=t,h=t,p=t;this.options.barWidth>this.options.trackWidth?(e-=o=(this.options.barWidth-this.options.trackWidth)/2,r-=o):this.options.barWidth<this.options.trackWidth&&(l-=o=(this.options.trackWidth-this.options.barWidth)/2,h-=o,n-=o,a-=o),this.options.bgColor&&(this.options.bgFull?this.bgArc=this.createArc(0,t,0,2*Math.PI):this.bgArc=this.createArc(0,t,i,s)),"tron"===this.options.skin.type&&(r=r-this.options.skin.width-this.options.skin.spaceWidth,l=l-this.options.skin.width-this.options.skin.spaceWidth,h=h-this.options.skin.width-this.options.skin.spaceWidth,p=p-this.options.skin.width-this.options.skin.spaceWidth,this.hoopArc=this.createArc(t-this.options.skin.width,t,i,s)),this.trackArc=this.createArc(e,r,i,s,this.options.trackCap),this.changeArc=this.createArc(n,l,i,i,this.options.barCap),this.valueArc=this.createArc(a,h,i,i,this.options.barCap),this.interactArc=this.createArc(1,p,i,s)},t.prototype.drawArcs=function(t,i){var o=s.select(this.element).append("svg").attr("width",this.options.size).attr("height",this.options.size);if(this.options.bgColor&&this.drawArc(o,this.bgArc,"bgArc",{fill:this.options.bgColor}),this.options.displayInput){var e=.2*this.options.size+"px";"auto"!==this.options.fontSize&&(e=this.options.fontSize+"px"),this.options.step<1&&(this.value=Number(this.value.toFixed(1)));var n=this.label||this.value;"function"==typeof this.options.inputFormatter&&(n=this.options.inputFormatter(n));var a="";"Arial"!==this.options.fontFamily&&(a=this.options.fontFamily);var r="";if("400"!==this.options.fontWeigth&&(r=this.options.fontWeigth),o.append("text").attr("id","text").attr("class","text-value").attr("text-anchor","middle").attr("font-size",e).attr("font-weight",r).attr("font-family",a).style("fill",this.options.textColor).text(n+this.options.unit||"").attr("transform","translate("+this.options.size/2+", "+(this.options.size/2+.06*this.options.size)+")"),this.options.subText.enabled){e=.07*this.options.size+"px","auto"!==this.options.subText.font&&(e=this.options.subText.font+"px");var l="";"Arial"!==this.options.subText.fontFamily&&(l=this.options.subText.fontFamily);var h="";"normal"!==this.options.subText.fontWeight&&(h=this.options.subText.fontWeight),o.append("text").attr("class","sub-text").attr("text-anchor","middle").attr("font-size",e).attr("font-family",l).attr("font-weight",h).style("fill",this.options.subText.color).text(this.options.subText.text).attr("transform","translate("+this.options.size/2+", "+(this.options.size/2+.15*this.options.size+this.options.subText.offset)+")")}}if(this.options.scale.enabled){var p,c,u=void 0,d=0,v=0,f=this.valueToRadians(this.options.min,this.options.max,this.options.endAngle,this.options.startAngle,this.options.min),g=this.valueToRadians(this.options.max,this.options.max,this.options.endAngle,this.options.startAngle,this.options.min),A=0;if(0===this.options.startAngle&&360===this.options.endAngle||(A=1),"dots"===this.options.scale.type){var m=this.options.scale.width;p=this.options.size/2-m,c=this.options.scale.quantity;var y=p+this.options.scale.width;u=s.range(c).map(function(){return v=d*(g-f)-Math.PI/2+f,d+=1/(c-A),{cx:y+Math.cos(v)*p,cy:y+Math.sin(v)*p,r:m}}),o.selectAll("circle").data(u).enter().append("circle").attr({r:function(t){return t.r},cx:function(t){return t.cx},cy:function(t){return t.cy},fill:this.options.scale.color})}else if("lines"===this.options.scale.type){var b=this.options.scale.height;p=this.options.size/2,c=this.options.scale.quantity,u=s.range(c).map(function(){return v=d*(g-f)-Math.PI/2+f,d+=1/(c-A),{x1:p+Math.cos(v)*p,y1:p+Math.sin(v)*p,x2:p+Math.cos(v)*(p-b),y2:p+Math.sin(v)*(p-b)}}),o.selectAll("line").data(u).enter().append("line").attr({x1:function(t){return t.x1},y1:function(t){return t.y1},x2:function(t){return t.x2},y2:function(t){return t.y2},"stroke-width":this.options.scale.width,stroke:this.options.scale.color})}}"tron"===this.options.skin.type&&this.drawArc(o,this.hoopArc,"hoopArc",{fill:this.options.skin.color}),this.drawArc(o,this.trackArc,"trackArc",{fill:this.options.trackColor}),this.options.displayPrevious?this.changeElem=this.drawArc(o,this.changeArc,"changeArc",{fill:this.options.prevBarColor}):this.changeElem=this.drawArc(o,this.changeArc,"changeArc",{"fill-opacity":0}),this.valueElem=this.drawArc(o,this.valueArc,"valueArc",{fill:this.options.barColor});var x="pointer";this.options.readOnly&&(x="default"),this.drawArc(o,this.interactArc,"interactArc",{"fill-opacity":0,cursor:x},t,i)},t.prototype.draw=function(){function t(){o.inDrag=!1;var t=s.mouse(this.parentNode);i(t[0]-o.options.size/2,t[1]-o.options.size/2,!0)}function i(t,i,e){var n,a=Math.atan(i/t)/(Math.PI/180);t>=0&&i<=0||t>=0&&i>=0?n=90:(n=270,o.options.startAngle<0&&(n=-90));var r=(n+a)*(Math.PI/180);if(o.value=o.radiansToValue(r,o.options.max,o.options.min,o.options.endAngle,o.options.startAngle),o.value>=o.options.min&&o.value<=o.options.max&&(o.value=Math.round(~~((o.value<0?-.5:.5)+o.value/o.options.step)*o.options.step*100)/100,o.options.step<1&&(o.value=Number(o.value.toFixed(1))),o.valueArc.endAngle(o.valueToRadians(o.value,o.options.max,o.options.endAngle,o.options.startAngle,o.options.min)),o.valueElem.attr("d",o.valueArc),e&&(o.changeArc.endAngle(o.valueToRadians(o.value,o.options.max,o.options.endAngle,o.options.startAngle,o.options.min)),o.changeElem.attr("d",o.changeArc)),o.options.displayInput)){var l=o.label||this.value;"function"==typeof o.options.inputFormatter&&(l=o.options.inputFormatter(l)),s.select(o.element).select("#text").text(l+o.options.unit||"")}o.valueChange.emit(o.value)}s.select(this.element).select("svg").remove();var o=this;o.createArcs();var e=s.drag().on("drag",function(){o.inDrag=!0,i(s.event.x-o.options.size/2,s.event.y-o.options.size/2,!1)}).on("end",t);o.drawArcs(t,e),o.options.animate.enabled?o.valueElem.transition().ease(o.animations[o.options.animate.ease]).duration(o.options.animate.duration).tween("",function(){var t=s.interpolate(o.valueToRadians(o.options.startAngle,360),o.valueToRadians(o.value,o.options.max,o.options.endAngle,o.options.startAngle,o.options.min));return function(i){var s=t(i);o.valueElem.attr("d",o.valueArc.endAngle(s)),o.changeElem.attr("d",o.changeArc.endAngle(s))}}):(o.changeArc.endAngle(this.valueToRadians(this.value,this.options.max,this.options.endAngle,this.options.startAngle,this.options.min)),o.changeElem.attr("d",o.changeArc),o.valueArc.endAngle(this.valueToRadians(this.value,this.options.max,this.options.endAngle,this.options.startAngle,this.options.min)),o.valueElem.attr("d",o.valueArc))},t.prototype.setValue=function(t){if(!this.inDrag&&this.value>=this.options.min&&this.value<=this.options.max){var i=this.valueToRadians(t,this.options.max,this.options.endAngle,this.options.startAngle,this.options.min);if(this.value=Math.round(~~((t<0?-.5:.5)+t/this.options.step)*this.options.step*100)/100,this.options.step<1&&(this.value=Number(this.value.toFixed(1))),this.changeArc.endAngle(i),s.select(this.element).select("#changeArc").attr("d",this.changeArc),this.valueArc.endAngle(i),s.select(this.element).select("#valueArc").attr("d",this.valueArc),this.options.displayInput){var o=this.label||this.value;"function"==typeof this.options.inputFormatter&&(o=this.options.inputFormatter(o)),s.select(this.element).select("#text").text(o+this.options.unit||"")}}},t.decorators=[{type:i.Directive,args:[{selector:"[ui-knob]"}]}],t.ctorParameters=function(){return[{type:i.ElementRef}]},t.propDecorators={value:[{type:i.Input}],label:[{type:i.Input}],options:[{type:i.Input}],valueChange:[{type:i.Output}]},t}(),e=function(){function t(){}return t.decorators=[{type:i.NgModule,args:[{exports:[o],declarations:[o]}]}],t.ctorParameters=function(){return[]},t}();t.KnobModule=e,t.Ng2KnobDirective=o,Object.defineProperty(t,"__esModule",{value:!0})});